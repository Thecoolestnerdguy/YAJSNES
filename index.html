<html>
<head>
<title> NES Emulator </title>
</head>

<body>

<script type = "text/javascript" src = "cpu.js"></script>
<script type = "text/javascript" src = "memory.js"></script>
<script type = "text/javascript" src = "clock.js"></script>

<script type = "text/javascript">

var romFile = document.createElement("input");
romFile.type = "file";
document.body.appendChild(romFile);

var canvas = document.createElement("canvas");
canvas.width = 640;
canvas.height = 480;
var ctx = canvas.getContext("2d");
document.body.appendChild(canvas);

var rodar = function()
{
  bla.execute();
  ctx.font = "30px Arial";
  ctx.clearRect(0,0,640,480);
  ctx.fillText(bla.A,50,50);
  ctx.fillText(bla.X,100,50);
  ctx.fillText(bla.Y,150,50);
  ctx.fillText(bla.PC.toString(16),50,100);
  ctx.fillText("C",50,150);
  ctx.fillText("Z",100,150);
  ctx.fillText("I",150,150);
  ctx.fillText("B",200,150);
  ctx.fillText("V",250,150);
  ctx.fillText("N",300,150);
  ctx.fillText(bla.C.toString()[0],50,200);
  ctx.fillText(bla.Z.toString()[0],100,200);
  ctx.fillText(bla.I.toString()[0],150,200);
  ctx.fillText(bla.B.toString()[0],200,200);
  ctx.fillText(bla.V.toString()[0],250,200);
  ctx.fillText(bla.N.toString()[0],300,200);
  window.requestAnimationFrame(rodar);
}

var bla;

romFile.addEventListener("change",function(e){
  memory = new Memory(e.target.files[0],function(mem){

    bla = new CPU(mem.cpuRead);
    rodar();

    window.addEventListener("keydown",function(e){

     if(e.keyCode === 69)
     {
       bla.execute();
       ctx.font = "30px Arial";
       ctx.clearRect(0,0,640,480);
       ctx.fillText(bla.A,50,50);
       ctx.fillText(bla.X,100,50);
       ctx.fillText(bla.Y,150,50);
       ctx.fillText(bla.PC.toString(16),50,100);
       ctx.fillText("C",50,150);
       ctx.fillText("Z",100,150);
       ctx.fillText("I",150,150);
       ctx.fillText("B",200,150);
       ctx.fillText("V",250,150);
       ctx.fillText("N",300,150);
       ctx.fillText(bla.C.toString()[0],50,200);
       ctx.fillText(bla.Z.toString()[0],100,200);
       ctx.fillText(bla.I.toString()[0],150,200);
       ctx.fillText(bla.B.toString()[0],200,200);
       ctx.fillText(bla.V.toString()[0],250,200);
       ctx.fillText(bla.N.toString()[0],300,200);
     }

    });

  });
});



</script>

</body>

</html>
